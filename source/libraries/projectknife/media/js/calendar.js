/**
 * @package      pkg_projectknife
 *
 * @author       Tobias Kuhn (eaxs)
 * @copyright    Copyright (C) 2015 Tobias Kuhn. All rights reserved.
 * @license      GNU General Public License version 2 or later.
 */
PKcal=window.PKcal||{},PKcal.setup=function(a){for(var b=a.dependencies,c=null,d=0;d<b.length;d++)c=jQuery("#"+b[d].field),c.length&&c.change(function(){PKcal.dependencyChange(a)})},PKcal.dependencyChange=function(a){for(var b=a.dependencies,c=a.settings.null_date,d=null,e=0,f=!0,g=0;g<b.length;g++)if(d=jQuery("#"+b[g].field),d.length&&(e=d.val(),""!=e&&"0"!=e)){f=!1,jQuery.ajax({url:"index.php?option="+b[g].option+"&task="+b[g].task,data:"tmpl=component&format=json&id="+e,type:"GET",processData:!0,cache:!1,dataType:"json",success:function(b){if(!b.success)return void Joomla.renderMessages(b.messages);if(b.data.start_date!=c&&b.data.due_date!=c){a.date_range_field&&jQuery("#"+a.date_range_field).val("["+b.data.start_date+", "+b.data.due_date+"]");var d=jQuery("#"+a.start_date_field),e=jQuery("#"+a.due_date_field),f=Date.parse(d.val()),g=Date.parse(e.val()),h=d.val(),i=e.val(),j=Date.parse(b.data.start_date),k=Date.parse(b.data.due_date);f<j?(f=j,h=b.data.start_date):k<f&&(f=k,h=b.data.due_date),k<g?(g=k,i=h):f>g&&(g=f,i=b.data.due_date),d.val(h),e.val(i);var l={field:a.start_date_field,format:a.settings.format,first_day:a.settings.first_day,start_date:b.data.start_date,due_date:b.data.due_date,range:!0};PKcal.update(l),l.field=a.due_date_field,PKcal.update(l)}}});break}if(f){a.date_range_field&&jQuery("#"+a.date_range_field).val("");var h={field:a.start_date_field,format:a.settings.format,first_day:a.settings.first_day,range:!1};PKcal.update(h),h.field=a.due_date_field,PKcal.update(h)}},PKcal.update=function(a){a.range?Calendar.setup({inputField:a.field,ifFormat:a.format,button:a.field+"_img",align:"Tl",singleClick:!0,firstDay:a.first_day,disableFunc:function(b){var c=parseInt(b.getTime()),d=Date.parse(a.start_date),e=Date.parse(a.due_date);return d>c||e<c}}):Calendar.setup({inputField:a.field,ifFormat:a.format,button:a.field+"_img",align:"Tl",singleClick:!0,firstDay:a.first_day})};